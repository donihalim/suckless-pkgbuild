# Maintainer:  DONIX <donihalim@protonmail.com>

_pkgbase=dmenu
pkgname=dmenu-dom
pkgver=5.1
pkgrel=1
pkgdesc="A generic menu for X"
url="http://tools.suckless.org/dmenu/"
arch=('x86_64')
license=('MIT')
depends=('libxinerama' 'libxft')
provides=(dmenu)
conflicts=(dmenu)
source=(
    https://dl.suckless.org/tools/dmenu-${pkgver}.tar.gz
    https://tools.suckless.org/dmenu/patches/password/dmenu-password-5.0.diff
    config.h
)
sha256sums=(
    '1f4d709ebba37eb7326eba0e665e0f13be4fa24ee35c95b0d79c30f14a348fd5'
    'SKIP'
    'SKIP'
)

prepare() {
    cd "${srcdir}/${_pkgbase}-${pkgver}"
    cp "${srcdir}/config.h" config.h
    cp "${srcdir}/dmenu-password-5.0.diff" dmenu-password-5.0.diff
    echo "Applying password patch..."
    patch -p1 < dmenu-password-5.0.diff
}

build(){
    cd "${srcdir}/${_pkgbase}-${pkgver}"
    NAME="${pkgname}" make
}

package() {
    cd "${srcdir}/${_pkgbase}-${pkgver}"
    NAME=${pkgname} make PREFIX=/usr DESTDIR="$pkgdir" install
    install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}
